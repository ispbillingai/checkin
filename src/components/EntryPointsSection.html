
<!-- Entry Points Section HTML -->
<div class="fade-in entry-points-section mb-20" style="animation-delay: 0.5s">
  <div class="text-center mb-10">
    <h2 class="text-3xl font-bold text-gray-800 mb-2">Available Entry Points</h2>
    <p class="text-lg text-gray-600 max-w-2xl mx-auto">Choose the entry points you'll need for your stay</p>
  </div>
  
  <div id="entryPointsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Loading placeholder will be replaced with entry points once loaded -->
  </div>
</div>

<script>
  // Initialize entry points section
  document.addEventListener('DOMContentLoaded', function() {
    console.log('EntryPointsSection.html: DOM content loaded - ENTRY POINTS LOG');
    
    // Clear any existing content and show loading state
    const container = document.getElementById('entryPointsContainer');
    if (container) {
      console.log('EntryPointsSection.html: Setting up loading state - ENTRY POINTS LOG');
      container.innerHTML = `
        <div class="col-span-full text-center text-gray-500">
          <p class="mb-4 text-blue-600 font-medium">Loading entry points...</p>
          <div class="animate-pulse">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              <div class="bg-white rounded-lg shadow-md p-6">
                <div class="h-5 bg-gray-200 rounded mb-4 w-3/4"></div>
                <div class="h-4 bg-gray-200 rounded mb-4"></div>
                <div class="h-10 bg-gray-200 rounded"></div>
              </div>
              <div class="bg-white rounded-lg shadow-md p-6">
                <div class="h-5 bg-gray-200 rounded mb-4 w-3/4"></div>
                <div class="h-4 bg-gray-200 rounded mb-4"></div>
                <div class="h-10 bg-gray-200 rounded"></div>
              </div>
              <div class="bg-white rounded-lg shadow-md p-6">
                <div class="h-5 bg-gray-200 rounded mb-4 w-3/4"></div>
                <div class="h-4 bg-gray-200 rounded mb-4"></div>
                <div class="h-10 bg-gray-200 rounded"></div>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    // Check if the initEntryPointsSection function is available
    if (typeof window.initEntryPointsSection === 'function') {
      console.log('EntryPointsSection.html: Calling initEntryPointsSection - ENTRY POINTS LOG');
      try {
        window.initEntryPointsSection();
      } catch (error) {
        console.error('EntryPointsSection.html: Error in initEntryPointsSection - ENTRY POINTS LOG', error);
        showEntryPointsError('Error initializing entry points');
      }
    } else {
      console.error('EntryPointsSection.html: initEntryPointsSection function not found - ENTRY POINTS LOG');
      
      // Try to load the script if not found
      const script = document.createElement('script');
      script.src = '/src/js/entry-points-data.js';
      script.onload = function() {
        console.log('EntryPointsSection.html: entry-points-data.js loaded - ENTRY POINTS LOG');
        
        if (typeof window.initEntryPointsSection === 'function') {
          console.log('EntryPointsSection.html: Initializing entry points after script load - ENTRY POINTS LOG');
          try {
            window.initEntryPointsSection();
          } catch (error) {
            console.error('EntryPointsSection.html: Error in initEntryPointsSection after script load - ENTRY POINTS LOG', error);
            showEntryPointsError('Error initializing entry points');
          }
        } else {
          console.error('EntryPointsSection.html: initEntryPointsSection function STILL not found after loading script - ENTRY POINTS LOG');
          showEntryPointsError('Failed to load entry points functionality');
          
          // Try direct API call as last resort
          console.log('EntryPointsSection.html: Attempting direct API call - ENTRY POINTS LOG');
          fetchEntryPointsDirectly();
        }
      };
      
      script.onerror = function() {
        console.error('EntryPointsSection.html: Failed to load entry-points-data.js - ENTRY POINTS LOG');
        showEntryPointsError('Failed to load entry points resources');
      };
      
      document.body.appendChild(script);
    }
  });
  
  // Function to show error in the entry points container
  function showEntryPointsError(message) {
    console.error('EntryPointsSection.html: ' + message + ' - ENTRY POINTS LOG');
    const container = document.getElementById('entryPointsContainer');
    if (container) {
      container.innerHTML = `
        <div class="col-span-full text-center">
          <div class="bg-red-50 border border-red-200 rounded-lg p-4 mx-auto max-w-md">
            <p class="text-red-600">${message}</p>
            <button onclick="retryLoadEntryPoints()" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
              Retry
            </button>
          </div>
        </div>
      `;
    }
  }
  
  // Function to retry loading entry points
  window.retryLoadEntryPoints = function() {
    console.log('EntryPointsSection.html: Retrying to load entry points - ENTRY POINTS LOG');
    const container = document.getElementById('entryPointsContainer');
    if (container) {
      container.innerHTML = '<div class="col-span-full text-center text-blue-600">Retrying to load entry points...</div>';
    }
    
    if (typeof window.initEntryPointsSection === 'function') {
      window.initEntryPointsSection();
    } else {
      // Try to load directly from API
      fetchEntryPointsDirectly();
    }
  };
  
  // Function to fetch entry points directly from API as fallback
  function fetchEntryPointsDirectly() {
    console.log('EntryPointsSection.html: Fetching entry points directly from API - ENTRY POINTS LOG');
    
    fetch('/api/get_entry_points.php')
      .then(response => {
        console.log(`EntryPointsSection.html: API response status: ${response.status} - ENTRY POINTS LOG`);
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log('EntryPointsSection.html: Entry points data received - ENTRY POINTS LOG', data);
        if (data.success && data.entry_points) {
          renderEntryPointsDirectly(data.entry_points);
        } else {
          throw new Error(data.message || 'No entry points data');
        }
      })
      .catch(error => {
        console.error('EntryPointsSection.html: Error fetching entry points directly - ENTRY POINTS LOG', error);
        // Fall back to demo data as a last resort
        console.log('EntryPointsSection.html: Using demo entry points as fallback - ENTRY POINTS LOG');
        const demoEntryPoints = [
          {
            id: 'entry1',
            name: 'Main Entrance',
            description: 'Front door at the main lobby'
          },
          {
            id: 'entry2',
            name: 'Side Entrance',
            description: 'Side entrance near the parking lot'
          },
          {
            id: 'entry3',
            name: 'Back Entrance',
            description: 'Back entrance near the garden'
          }
        ];
        renderEntryPointsDirectly(demoEntryPoints);
      });
  }
  
  // Function to render entry points directly as fallback
  function renderEntryPointsDirectly(entryPoints) {
    console.log(`EntryPointsSection.html: Rendering ${entryPoints.length} entry points directly - ENTRY POINTS LOG`);
    const container = document.getElementById('entryPointsContainer');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (!entryPoints || entryPoints.length === 0) {
      container.innerHTML = '<div class="col-span-full text-center text-gray-500">No entry points available. Please contact support.</div>';
      return;
    }
    
    entryPoints.forEach(entry => {
      const card = document.createElement('div');
      card.className = "bg-white rounded-lg shadow-md overflow-hidden transition-transform hover:shadow-lg hover:-translate-y-1";
      
      card.innerHTML = `
        <div class="p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-2">${entry.name}</h3>
          <p class="text-gray-600 mb-4">${entry.description || 'No description available'}</p>
          <button 
            class="select-entry-point-btn bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors w-full" 
            data-entry-id="${entry.id}" 
            data-entry-name="${entry.name}"
          >
            Select Entry Point
          </button>
        </div>
      `;
      
      container.appendChild(card);
    });
    
    // Add event listeners to buttons
    document.querySelectorAll('.select-entry-point-btn').forEach(button => {
      button.addEventListener('click', function() {
        const entryId = this.getAttribute('data-entry-id');
        const entryName = this.getAttribute('data-entry-name');
        console.log(`EntryPointsSection.html: Entry point selected: ${entryName} (${entryId}) - ENTRY POINTS LOG`);
        
        // Find the corresponding checkbox in the booking form
        const checkbox = document.getElementById(`entryPoint_${entryId}`);
        if (checkbox) {
          checkbox.checked = true;
          const event = new Event('change');
          checkbox.dispatchEvent(event);
          console.log(`EntryPointsSection.html: Checked entry point checkbox for ${entryName} - ENTRY POINTS LOG`);
        } else {
          console.error(`EntryPointsSection.html: Could not find checkbox for entry point ${entryId} - ENTRY POINTS LOG`);
        }
        
        // Scroll to booking form
        const bookingForm = document.getElementById('bookingForm');
        if (bookingForm) {
          bookingForm.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Show toast if available
        if (window.showToastMessage) {
          window.showToastMessage('success', `${entryName} selected. Please complete your booking.`);
        }
      });
    });
  }
</script>

